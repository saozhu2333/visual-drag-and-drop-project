<!-- <!DOCTYPE html>
<html lang="en">
    <head>
        <title>SVG Click Detection</title>
        <script>
                function isPathClicked(event) {
            // 获取点击的坐标
            const clickX = event.clientX;
            const clickY = event.clientY;

            // 获取SVG元素和路径元素
            const svg = document.getElementById('svg');
            const path = document.getElementById('path');

            // 创建一个新的SVG点
            const svgPoint = svg.createSVGPoint();
            svgPoint.x = clickX;
            svgPoint.y = clickY;

            // 将点击的点转换为SVG坐标系
            const transformedPoint = svgPoint.matrixTransform(svg.getScreenCTM().inverse());

            // 获取路径的总长度
            const length = path.getTotalLength();

            // 检查点是否在路径上
            let isClicked = false;
            for (let i = 0; i < length; i += 1) {
                const point = path.getPointAtLength(i);
                if (Math.abs(point.x - transformedPoint.x) < 2 && Math.abs(point.y - transformedPoint.y) < 2) {
                    isClicked = true;
                    break;
                }
            }

            if (isClicked) {
                console.log('路径被点击了！')
            } else {
                console.log('路径没有被点击。')

            }
        }
        </script>
    </head>
    <body>
    
    <svg id="svg" width="200" height="200" xmlns="http://www.w3.org/2000/svg" onclick="isPathClicked(event)">
        <path id="path" d="M10,10 L50,50 L100,20 L150,100" stroke="black" stroke-width="2" fill="none"/>
    </svg>
    
    </body>
</html> -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>SVG Click Detection</title>
        <script>
            function distanceToSegment(p, v, w) {
                const l2 = (v.x - w.x) ** 2 + (v.y - w.y) ** 2;
                if (l2 === 0) return Math.sqrt((p.x - v.x) ** 2 + (p.y - v.y) ** 2);
                const t = Math.max(0, Math.min(1, ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2));
                const projection = { x: v.x + t * (w.x - v.x), y: v.y + t * (w.y - v.y) };
                return Math.sqrt((p.x - projection.x) ** 2 + (p.y - projection.y) ** 2);
            }
    
            function isPolylineClicked(event) {
                // 获取点击的坐标
                const clickX = event.clientX;
                const clickY = event.clientY;
    
                // 获取SVG元素和polyline元素
                const svg = document.getElementById('svg');
                const polyline = document.getElementById('polyline');
    
                // 创建一个新的SVG点
                const svgPoint = svg.createSVGPoint();
                svgPoint.x = clickX;
                svgPoint.y = clickY;
    
                // 将点击的点转换为SVG坐标系
                const transformedPoint = svgPoint.matrixTransform(svg.getScreenCTM().inverse());
    
                // 获取polyline的points属性值
                const points = polyline.getAttribute('points').split(' ');
    
                // 检查点是否在polyline上
                let isClicked = false;
                for (let i = 0; i < points.length - 1; i++) {
                    const [x1, y1] = points[i].split(',').map(Number);
                    const [x2, y2] = points[i + 1].split(',').map(Number);
                    const dist = distanceToSegment(transformedPoint, { x: x1, y: y1 }, { x: x2, y: y2 });
                    if (dist < 5) {
                        isClicked = true;
                        break;
                    }
                }
    
                if (isClicked) {
                    console.log('polyline的线段被点击了！')

                } else {
                    console.log('polyline的线段没有被点击。')

                }
            }
        </script>
    </head>
    <body>
    
    <svg id="svg" width="200" height="200" xmlns="http://www.w3.org/2000/svg" onclick="isPolylineClicked(event)">
        <polyline id="polyline" points="10,10 50,50 100,20 150,100" stroke="black" stroke-width="2" fill="none"/>
    </svg>
    
    </body>
</html>